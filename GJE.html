<head>
<title>Game Jam Editor</title>
<script src= "js/codemirror.js"></script>
<link rel="stylesheet" href="css/codemirror.css">
<script src= "js/javascript.js"></script>
 <link rel="stylesheet" href="css/base16-dark.css"> 
 <script src= "js/matchbrackets.js"></script>
 <link rel="stylesheet" href="css/GJE.css" />
</head>
<body>

</head>
<body>

<button onclick="document.getElementById('fread').click();"style="background-color: yellow; color: red;">LOAD</button>
<button onclick="test()" style="background-color: green; color: white;">TEST</button>
<button onclick="save()"style="background-color: blue; color: white;">SAVE</button>
<button onclick="shipIt()"style="background-color: red; color: yellow;">SHIP IT</button>
<input type="text" id="search" name="google">
<button onclick="gSearch()">SEARCH</button>
<br>
<button onclick="codemirrorEditor.undo()">UNDO</button>
<button id="E_Button" onclick="changeMode(0)" style="background-color: black; color: white; border-top-color: white; border-bottom-color: white; border-right-color: white; border-left-color: white;">MISC</button>
<button id="I_Button" onclick="changeMode(1)" style="background-color: black; color: white; border-top-color: white; border-bottom-color: white; border-right-color: white; border-left-color: white;">INIT</button>
<button id="U_Button" onclick="changeMode(2)" style="background-color: black; color: white; border-top-color: white; border-bottom-color: white; border-right-color: white; border-left-color: white;">UPDATE</button>
<button id="D_Button" onclick="changeMode(3)" style="background-color: black; color: white; border-top-color: white; border-bottom-color: white; border-right-color: white; border-left-color: white;">DRAW</button>
<button id="J_Button" onclick="changeMode(4)">JUNK_DRAWER</button>
<button onclick="codemirrorEditor.redo()">REDO</button>


<div id='m'>
<input id="fread" type='file' style="display: none" accept='.js' onchange='openFile(event)'>
<textarea id='codearea' >



</textarea>
</div>
<script>
var GJE_engine='////GJE_engine////';
var GJE_init='////GJE_init////';
var GJE_update='////GJE_update////';
var GJE_draw='////GJE_draw////';
var GJE_JUNK_DRAWER='////GJE_JUNK_DRAWER////';
var GJE_mode=0;//engine edit mode
function LoadMem(){
	if (localStorage.getItem("GJE_engine.code") != null) {GJE_engine=localStorage.getItem("GJE_engine.code");}
	if (localStorage.getItem("GJE_init.code") != null) {GJE_init=localStorage.getItem("GJE_init.code");}
	if (localStorage.getItem("GJE_update.code") != null) {GJE_update=localStorage.getItem("GJE_update.code");}
	if (localStorage.getItem("GJE_draw.code") != null) {GJE_draw=localStorage.getItem("GJE_draw.code");}
	if (localStorage.getItem("GJE_JUNK_DRAWER.code") != null) {GJE_JUNK_DRAWER=localStorage.getItem("GJE_JUNK_DRAWER.code");}
}
function SaveMem(){
	localStorage.setItem("GJE_engine.code", GJE_engine);
	localStorage.setItem("GJE_init.code", GJE_init);
	localStorage.setItem("GJE_update.code", GJE_update);
	localStorage.setItem("GJE_draw.code", GJE_draw);
	localStorage.setItem("GJE_JUNK_DRAWER.code", GJE_JUNK_DRAWER);
}

function gSearch(){
var st= document.getElementById("search").value
let win1 = window.open( "https://www.google.com/search?client=ms-opera-mini-android&sxsrf=ALiCzsZNz3HOg9p9jhqIYimzTsp8aabxeA%3A1652635507148&oq="+st+"&aqs=mobile-gws-lite..35i39l1j0l4...5&source=hp&q="+st, '_blank');

}
	
function showCode(){
	if(GJE_mode==0){codemirrorEditor.setValue(GJE_engine);}
	if(GJE_mode==1){codemirrorEditor.setValue(GJE_init);}
	if(GJE_mode==2){codemirrorEditor.setValue(GJE_update);}
	if(GJE_mode==3){codemirrorEditor.setValue(GJE_draw);}
	if(GJE_mode==4){codemirrorEditor.setValue(GJE_JUNK_DRAWER);}
	
}

const codemirrorEditor = CodeMirror.fromTextArea(document.getElementById('codearea'), {
  lineNumbers: true,
  matchBrackets: true,
  mode: "javascript",
  theme: "base16-dark"
  
});

codemirrorEditor.on("change",function(cm,change){
	saveCode();
});

LoadMem(); // first checks if previous session has stored any code in memory.
SaveMem(); //resaves so none of the local memory used is null.
showCode();//shows code 
changeMode(GJE_mode)
codemirrorEditor.clearHistory()

function saveCode(){
	if(GJE_mode==0){GJE_engine=codemirrorEditor.getValue()}
	if(GJE_mode==1){GJE_init=codemirrorEditor.getValue()}
	if(GJE_mode==2){GJE_update=codemirrorEditor.getValue()}
	if(GJE_mode==3){GJE_draw=codemirrorEditor.getValue()}
	if(GJE_mode==4){GJE_JUNK_DRAWER=codemirrorEditor.getValue()}
    SaveMem();
}

function changeMode(mode){
	if(GJE_mode==0){GJE_engine=codemirrorEditor.getValue()}
	if(GJE_mode==1){GJE_init=codemirrorEditor.getValue()}
	if(GJE_mode==2){GJE_update=codemirrorEditor.getValue()}
	if(GJE_mode==3){GJE_draw=codemirrorEditor.getValue()}
	if(GJE_mode==4){GJE_JUNK_DRAWER=codemirrorEditor.getValue()}
    SaveMem();
	GJE_mode=mode;
	showCode();
	codemirrorEditor.getDoc().clearHistory(); // add this line
    codemirrorEditor.refresh();
	var tempE=document.getElementById("E_Button");
	var tempI=document.getElementById("I_Button");
	var tempU=document.getElementById("U_Button");
	var tempD=document.getElementById("D_Button");
	var tempJ=document.getElementById("J_Button");
	
	if(GJE_mode==0){
		tempE.style.background = 'purple';
		tempI.style.background = 'black';
		tempU.style.background = 'black';
		tempD.style.background = 'black';
		tempJ.style.background = 'white';
	}
	if(GJE_mode==1){
		tempE.style.background = 'black';
		tempI.style.background = 'purple';
		tempU.style.background = 'black';
		tempD.style.background = 'black';
		tempJ.style.background = 'white';
	}
	if(GJE_mode==2){
		tempE.style.background = 'black';
		tempI.style.background = 'black';
		tempU.style.background = 'purple';
		tempD.style.background = 'black';
		tempJ.style.background = 'white';
	}
	if(GJE_mode==3){
		tempE.style.background = 'black';
		tempI.style.background = 'black';
		tempU.style.background = 'black';
		tempD.style.background = 'purple';
		tempJ.style.background = 'white';
	}
	if(GJE_mode==4){
		tempE.style.background = 'black';
		tempI.style.background = 'black';
		tempU.style.background = 'black';
		tempD.style.background = 'black';
		tempJ.style.background = 'purple';
	}
}
function download(filename, text) {
if(filename=='null.js'){return}
if(filename=='null.html'){return}
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click(); 

  document.body.removeChild(element);
 
}
var openFile = function(event) {
	var input = event.target;

	var reader = new FileReader();
	reader.onload = function(){
	  var text = reader.result;
	  var name = document.getElementById('fread'); 
	  saveName=name.files.item(0).name
	  if(GJE_mode==0){GJE_engine=text}
	  if(GJE_mode==1){GJE_init=text}
	  if(GJE_mode==2){GJE_update=text}
	  if(GJE_mode==3){GJE_draw=text}
	  codemirrorEditor.setValue(text);
	  var lbl = document.getElementById("fname")
	  //lbl.innerText=saveName;
	  //console.log(reader.result.substring(0, 200));
	};
	reader.readAsText(input.files[0]);
  };
function save(){
var c = codemirrorEditor.getValue()
download(prompt("script name?") + ".js",c)
}
function test(){
localStorage.setItem("GJE.code",codemirrorEditor.getValue())
//window.open(URL, '_blank');
var myWindow = window.open("GJE_TEST.html", "_blank"); //, "width=1200,height=500");

//var c = '<body><canvas width="1000" height="1000" id="main">' + '</canvas></body><style>canvas{background-color: white;width: 100%;  height: 100%;}body {margin: 0;padding: 0;}' + "<"+ '/style>';
//c = c + '<scr'+'ipt src= "evo.js"></scr'+'ipt><scr'+'ipt>'
//c = c + '<script>function startLoop(){update();window.requestAnimationFrame(startLoop)};var canvas=document.getElementById("main"),ctx=canvas.getContext("2d"),running=!0;const interval=setInterval(function(){1==running&&(ctx.clearRect(0,0,canvas.width,canvas.height),console.log("a"))},.1);class Camera{constructor(t,s){this.x=t,this.y=s}}class Text{constructor(t,s,i,e,c){this.x=t,this.y=s,this.col=c,this.txt=i,this.font=e}draw(){ctx.font=this.font,ctx.fillStyle=this.col,ctx.fillText(this.txt,this.x,this.y)}}class Circle{constructor(t,s,i,e){this.x=t,this.y=s,this.r=i,this.col=e}draw(){ctx.fillStyle=this.col,ctx.fill(),ctx.strokeStyle=this.col,ctx.beginPath(),ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.stroke()}}class Rectangle{constructor(t,s,i,e,c){this.rot=0,this.x=t,this.y=s,this.w=i,this.h=e,this.col=c}draw(){ctx.fillStyle=this.col,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rot*Math.PI/180),ctx.fillRect(this.x,this.y,this.w,this.h),ctx.restore()}}class Line{constructor(t,s,i,e,c){this.x=t,this.y=s,this.x2=i,this.y2=e,this.col=c,this.rot=0}draw(){ctx.fillStyle=this.col,ctx.strokeStyle=this.col,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rot*Math.PI/180),ctx.moveTo(this.x,this.y),ctx.lineTo(this.x2,this.y2),ctx.stroke(),ctx.restore()}}class Sprite{constructor(t,s,i,e,c){this.rot=0,this.timer,this.url=t,this.img,this.x=s,this.y=i,this.w=e,this.h=c}setup(){this.img=new Image,this.img.src=this.url,ctx.drawImage(this.img,this.x,this.y,this.w,this.h)}draw(){ctx.drawImage(this.img,this.x-camera.x,this.y-camera.y,this.w,this.h)}}var camera=new Camera(0,0),key="null";function kd(t){key=t.key}function ku(t){key="null"}document.onkeydown=kd,document.onkeyup=ku;var mouseX=0,mouseY=0,mouseDown=!1;function getCursorPosition(t,s){const i=t.getBoundingClientRect(),e=s.clientX-i.left,c=s.clientY-i.top;mouseX=e,mouseY=c}function colliding(t,s){var i=t,e=s;return i.x<e.x+e.w&&i.x+i.w>e.x&&i.y<e.y+e.h&&i.y+i.h>e.y}canvas.addEventListener("mousemove",function(t){getCursorPosition(canvas,t)}),canvas.addEventListener("mousedown",function(t){mouseDown=!0}),canvas.addEventListener("mouseup",function(t){mouseDown=!1});';
var c = '<!DOC'+'TYPE html>'+'<ht'+'ml>'+'<tit'+'le>TEST GAME</tit'+'le>'+'<bo'+'dy>'+'<scri'+'pt>'+codemirrorEditor.getValue() + '<' + '/scr'+'ipt>'+'</bo'+'dy>'+'</ht'+'ml>';
//myWindow.document.write(c);
}

function shipIt(){
//var c = '<body><canvas width="1000" height="1000" id="main">' + '</canvas></body><style>canvas{background-color: white;width: 100%;  height: 100%;}body {margin: 0;padding: 0;}' + "<"+ '/style>';
//c = c + '<scr'+'ipt src= "evo.js"></scr'+'ipt><scr'+'ipt>'
//c = c + '<script>function startLoop(){update();window.requestAnimationFrame(startLoop)};var canvas=document.getElementById("main"),ctx=canvas.getContext("2d"),running=!0;const interval=setInterval(function(){1==running&&(ctx.clearRect(0,0,canvas.width,canvas.height),console.log("a"))},.1);class Camera{constructor(t,s){this.x=t,this.y=s}}class Text{constructor(t,s,i,e,c){this.x=t,this.y=s,this.col=c,this.txt=i,this.font=e}draw(){ctx.font=this.font,ctx.fillStyle=this.col,ctx.fillText(this.txt,this.x,this.y)}}class Circle{constructor(t,s,i,e){this.x=t,this.y=s,this.r=i,this.col=e}draw(){ctx.fillStyle=this.col,ctx.fill(),ctx.strokeStyle=this.col,ctx.beginPath(),ctx.arc(this.x,this.y,this.r,0,2*Math.PI),ctx.stroke()}}class Rectangle{constructor(t,s,i,e,c){this.rot=0,this.x=t,this.y=s,this.w=i,this.h=e,this.col=c}draw(){ctx.fillStyle=this.col,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rot*Math.PI/180),ctx.fillRect(this.x,this.y,this.w,this.h),ctx.restore()}}class Line{constructor(t,s,i,e,c){this.x=t,this.y=s,this.x2=i,this.y2=e,this.col=c,this.rot=0}draw(){ctx.fillStyle=this.col,ctx.strokeStyle=this.col,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.rot*Math.PI/180),ctx.moveTo(this.x,this.y),ctx.lineTo(this.x2,this.y2),ctx.stroke(),ctx.restore()}}class Sprite{constructor(t,s,i,e,c){this.rot=0,this.timer,this.url=t,this.img,this.x=s,this.y=i,this.w=e,this.h=c}setup(){this.img=new Image,this.img.src=this.url,ctx.drawImage(this.img,this.x,this.y,this.w,this.h)}draw(){ctx.drawImage(this.img,this.x-camera.x,this.y-camera.y,this.w,this.h)}}var camera=new Camera(0,0),key="null";function kd(t){key=t.key}function ku(t){key="null"}document.onkeydown=kd,document.onkeyup=ku;var mouseX=0,mouseY=0,mouseDown=!1;function getCursorPosition(t,s){const i=t.getBoundingClientRect(),e=s.clientX-i.left,c=s.clientY-i.top;mouseX=e,mouseY=c}function colliding(t,s){var i=t,e=s;return i.x<e.x+e.w&&i.x+i.w>e.x&&i.y<e.y+e.h&&i.y+i.h>e.y}canvas.addEventListener("mousemove",function(t){getCursorPosition(canvas,t)}),canvas.addEventListener("mousedown",function(t){mouseDown=!0}),canvas.addEventListener("mouseup",function(t){mouseDown=!1});';
//var c = '<!DOC'+'TYPE html>'+'<ht'+'ml>'+'<bo'+'dy>'+'<scri'+'pt>';
var c = '<!DOC'+'TYPE html>'
c = c + "<meta name='apple-mobile-web-app-capable' content='yes' />"
c = c + "<meta name='viewport' content='initial-scale=1.0, maximum-scale=1.0, user-scalable=0, width=device-width, height=device-height' />"
c = c + "<meta name='apple-mobile-web-app-status-bar-style' content='black-translucent' />"
c = c + '<bo'+'dy>'+'<scri'+'pt>';
c = c + GJE_engine + GJE_init + GJE_update + GJE_draw + '<' + '/scr'+'ipt>'+'</bo'+'dy>'+'</ht'+'ml>';
download(prompt("game name?") + ".html",c)
}
</script>